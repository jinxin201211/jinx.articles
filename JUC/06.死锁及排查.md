# 死锁及排查

死锁是指两个或多个事务在运行过程中因竞争资源而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的事务称为死锁进程。

产生死锁的四个必要条件：

1. 互斥条件：一个资源每次只能被一个进程使用。
2. 请求与保持条件：一个进程因请求资源而阻塞时，对已获得的资源保持不放。
3. 不剥夺条件：进程已获得的资源，在未使用之前，不能强行剥夺。
4. 循环等待条件：若干进程之间形成一种头尾相接的循环等待资源关系。

解决死锁的方法：

1. 预防死锁：在资源分配之前，就确定系统的安全状态。
2. 避免死锁：在资源分配过程中，通过调度程序，使之不进入不安全状态。
3. 检测死锁：允许系统进入不安全状态，通过检测死锁，进行处理。
4. 解除死锁：当检测出死锁发生时，采取措施进行处理。

## 排查死锁

- `jps -l` 列出进程
- `jstack -l 进程 id` 列出进程的线程信息，如果发生了死锁，可以看到死锁信息
- `jconsole 进程 id` 图形化界面，检测死锁
